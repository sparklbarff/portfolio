/* Authentic CRT + VHS Emulation System */

:root {
  --crt-curvature: 0.02;
  --phosphor-persistence: 0.15;
  --vhs-tracking-stability: 0.95;
  --color-temperature: 6500K;
}

/* Layer 1: VHS Signal Characteristics */
.vhs-signal-layer {
  position: fixed;
  inset: 0;
  z-index: 35;
  pointer-events: none;
  
  /* VHS chroma bleeding and saturation reduction */
  backdrop-filter: 
    contrast(0.98) 
    saturate(0.92) 
    brightness(1.01);
  -webkit-backdrop-filter: 
    contrast(0.98) 
    saturate(0.92) 
    brightness(1.01);
  
  filter: url(#vhs-chroma-bleed);
  opacity: 0.85;
}

/* Layer 2: CRT Geometry and Phosphors */
.crt-display-layer {
  position: fixed;
  inset: 0;
  z-index: 36;
  pointer-events: none;
  
  /* Authentic CRT geometry distortion */
  filter: url(#crt-geometry);
  
  /* P22 Phosphor dot pattern (very subtle) */
  background-image: 
    radial-gradient(circle at 0px 0px, rgba(0,255,100,0.02) 0.5px, transparent 1px),
    radial-gradient(circle at 1px 1px, rgba(255,100,100,0.015) 0.5px, transparent 1px),
    radial-gradient(circle at 2px 0px, rgba(100,150,255,0.018) 0.5px, transparent 1px);
  background-size: 3px 3px;
  background-position: 0 0, 1px 1px, 2px 0;
  opacity: 0.08;
  mix-blend-mode: screen;
}

/* Layer 3: CRT Scanlines (Realistic TV resolution) */
.crt-scanlines {
  position: fixed;
  inset: 0;
  z-index: 37;
  pointer-events: none;
  mix-blend-mode: multiply;
  
  /* 525-line NTSC pattern */
  background-image: 
    repeating-linear-gradient(
      rgba(0,0,0,0.04) 0px,
      rgba(0,0,0,0.02) 1px,
      transparent 2px,
      rgba(0,0,0,0.03) 3px,
      transparent 4px
    );
  
  animation: scanlineFlicker 12s ease-in-out infinite;
  opacity: 0.6;
  
  /* CRT curvature mask */
  mask-image: 
    radial-gradient(
      ellipse 98% 96% at center, 
      rgba(0,0,0,1) 65%, 
      rgba(0,0,0,0.9) 85%, 
      rgba(0,0,0,0.3) 98%, 
      transparent 100%
    );
  -webkit-mask-image: 
    radial-gradient(
      ellipse 98% 96% at center, 
      rgba(0,0,0,1) 65%, 
      rgba(0,0,0,0.9) 85%, 
      rgba(0,0,0,0.3) 98%, 
      transparent 100%
    );
}

/* Layer 4: VHS Tracking Errors */
.vhs-tracking-layer {
  position: fixed;
  inset: 0;
  z-index: 38;
  pointer-events: none;
  opacity: 0;
  
  /* Horizontal tracking lines */
  background: 
    linear-gradient(
      rgba(0,0,0,0.12) 0px,
      rgba(0,0,0,0.12) 2px,
      transparent 3px,
      transparent 100%
    );
  
  animation: vhsTrackingGlitch 180s steps(1) infinite;
  mix-blend-mode: multiply;
}

/* Layer 5: CRT Phosphor Glow */
.crt-phosphor-layer {
  position: fixed;
  inset: 0;
  z-index: 39;
  pointer-events: none;
  
  /* Phosphor afterglow simulation */
  backdrop-filter: 
    brightness(1.008) 
    contrast(1.015) 
    saturate(1.05);
  -webkit-backdrop-filter: 
    brightness(1.008) 
    contrast(1.015) 
    saturate(1.05);
  
  filter: url(#crt-phosphor-decay);
  opacity: 0.25;
  mix-blend-mode: screen;
}

/* Layer 6: CRT Vignette (Authentic edge darkening) */
.crt-vignette {
  position: fixed;
  inset: 0;
  z-index: 40;
  pointer-events: none;
  
  /* Realistic CRT edge characteristics */
  background: 
    /* Corner darkening from electron gun geometry */
    radial-gradient(
      ellipse 140% 130% at 10% 10%, 
      rgba(0,0,0,0.15), 
      transparent 40%
    ),
    radial-gradient(
      ellipse 140% 130% at 90% 10%, 
      rgba(0,0,0,0.15), 
      transparent 40%
    ),
    radial-gradient(
      ellipse 140% 130% at 10% 90%, 
      rgba(0,0,0,0.15), 
      transparent 40%
    ),
    radial-gradient(
      ellipse 140% 130% at 90% 90%, 
      rgba(0,0,0,0.15), 
      transparent 40%
    ),
    /* Main vignette with realistic falloff */
    radial-gradient(
      ellipse 92% 88% at 50% 50%, 
      rgba(0,0,0,0) 45%, 
      rgba(0,0,0,0.08) 75%, 
      rgba(0,0,0,0.18) 92%, 
      rgba(0,0,0,0.35) 100%
    );
  
  mix-blend-mode: multiply;
  opacity: 0.8;
}

/* Layer 7: VHS Head Switching (Rare) */
.vhs-head-switch {
  position: fixed;
  left: 0;
  right: 0;
  top: 40%;
  height: 3px;
  z-index: 41;
  pointer-events: none;
  opacity: 0;
  
  background: 
    linear-gradient(
      to right,
      rgba(0,0,0,0.3) 0%,
      rgba(0,0,0,0.15) 100%
    );
  
  animation: vhsHeadSwitchNoise 240s steps(1) infinite;
  mix-blend-mode: multiply;
}

/* Layer 8: CRT Retrace (Very rare) */
.crt-retrace-sweep {
  position: fixed;
  left: 0;
  right: 0;
  top: -8vh;
  height: 12vh;
  z-index: 42;
  pointer-events: none;
  opacity: 0;
  
  /* Realistic electron beam retrace */
  backdrop-filter: 
    contrast(1.08) 
    brightness(1.03) 
    blur(0.3px);
  -webkit-backdrop-filter: 
    contrast(1.08) 
    brightness(1.03) 
    blur(0.3px);
  
  mask-image: 
    linear-gradient(
      to bottom, 
      transparent 0%, 
      rgba(0,0,0,0.2) 25%, 
      rgba(0,0,0,0.5) 50%, 
      rgba(0,0,0,0.2) 75%, 
      transparent 100%
    );
  -webkit-mask-image: 
    linear-gradient(
      to bottom, 
      transparent 0%, 
      rgba(0,0,0,0.2) 25%, 
      rgba(0,0,0,0.5) 50%, 
      rgba(0,0,0,0.2) 75%, 
      transparent 100%
    );
  
  mix-blend-mode: overlay;
  will-change: transform, opacity;
}

/* Authentic CRT retrace animation (60Hz) */
@keyframes crtRetraceSweep {
  0%   { 
    transform: translateY(-100vh); 
    opacity: 0;
  }
  2%   { 
    opacity: 0.12;
  }
  50%  { 
    transform: translateY(60vh); 
    opacity: 0.08;
  }
  98%  { 
    opacity: 0.12;
  }
  100% { 
    transform: translateY(200vh); 
    opacity: 0;
  }
}

.crt-retrace-sweep.run { 
  animation: crtRetraceSweep 0.5s cubic-bezier(.1,.8,.2,.9) forwards;
  opacity: 1;
}

/* Text elements with phosphor glow */
.tg-letter {
  position: relative;
  display: inline-block;
  filter: url(#crt-phosphor-p22);
  transition: all 0.8s ease;
}

.tg-letter.phosphor-glow {
  filter: url(#crt-phosphor-p22) url(#crt-phosphor-decay);
  text-shadow: 
    0 0 3px rgba(100, 255, 150, 0.15),
    0 0 6px rgba(100, 255, 150, 0.08);
}

/* Animation keyframes for realistic effects */
@keyframes scanlineFlicker {
  0% { 
    opacity: 0.6; 
    transform: translateY(0px);
  }
  15% { 
    opacity: 0.58; 
    transform: translateY(0.2px);
  }
  30% { 
    opacity: 0.62; 
    transform: translateY(-0.1px);
  }
  45% { 
    opacity: 0.59; 
    transform: translateY(0.1px);
  }
  60% { 
    opacity: 0.61; 
    transform: translateY(-0.05px);
  }
  75% { 
    opacity: 0.58; 
    transform: translateY(0.15px);
  }
  90% { 
    opacity: 0.6; 
    transform: translateY(-0.1px);
  }
  100% { 
    opacity: 0.6; 
    transform: translateY(0px);
  }
}

@keyframes vhsTrackingGlitch {
  0% { opacity: 0; transform: translateY(0); }
  0.5% { opacity: 0.3; transform: translateY(15vh); }
  1% { opacity: 0; transform: translateY(30vh); }
  98.5% { opacity: 0; }
  99% { opacity: 0.2; transform: translateY(-25vh); }
  99.5% { opacity: 0; transform: translateY(-15vh); }
  100% { opacity: 0; transform: translateY(0); }
}

@keyframes vhsHeadSwitchNoise {
  0% { opacity: 0; }
  0.2% { opacity: 0.6; }
  0.4% { opacity: 0; }
  99.6% { opacity: 0; }
  99.8% { opacity: 0.4; }
  100% { opacity: 0; }
}

/* VHS tracking shift for text elements */
@keyframes vhsTrackingShift {
  0% { transform: translateX(0px) skewX(0deg); }
  20% { transform: translateX(-1px) skewX(-0.1deg); }
  40% { transform: translateX(1.5px) skewX(0.15deg); }
  60% { transform: translateX(-0.8px) skewX(-0.08deg); }
  80% { transform: translateX(0.5px) skewX(0.05deg); }
  100% { transform: translateX(0px) skewX(0deg); }
}

.horizontal-hold-error {
  animation: vhsTrackingShift 1.8s ease-out forwards;
}

/* Motion and accessibility controls */
@media (prefers-reduced-motion: reduce) {
  .vhs-signal-layer,
  .crt-display-layer,
  .crt-scanlines,
  .vhs-tracking-layer,
  .crt-phosphor-layer,
  .crt-vignette,
  .vhs-head-switch,
  .crt-retrace-sweep {
    display: none !important;
  }
  
  .tg-letter {
    filter: none !important;
  }
}

[data-motion="paused"] .vhs-signal-layer,
[data-motion="paused"] .crt-display-layer,
[data-motion="paused"] .crt-scanlines,
[data-motion="paused"] .vhs-tracking-layer,
[data-motion="paused"] .crt-phosphor-layer,
[data-motion="paused"] .vhs-head-switch,
[data-motion="paused"] .crt-retrace-sweep {
  animation-play-state: paused !important;
  display: none;
}

[data-motion="paused"] .crt-retrace-sweep.run {
  animation: none !important;
}

[data-motion="paused"] .tg-letter {
  filter: none !important;
}