/* JetBrains Mono from Google Fonts via the HTML <link>. No local @font-face. */

/* ---------- Root + tokens ---------- */
:root{
  --vh: 1vh;

  --font-ui: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;

  --bg:#0a0a0a; --fg:#e8e8e8; --muted:#a8a8a8;

  --crt-cyan:#00ffc8; --crt-magenta:#ff004c; --crt-blue:#00aaff;

  --fade-dur:14.25s;   /* 5% faster (was 15s) */
  --period:19s;        /* 5% faster (was 20s) */

  --ui-bottom-pad:72px;
  --bg-current:none;
}

/* ---------- Base ---------- */
*{ box-sizing:border-box; -webkit-tap-highlight-color: transparent; }
html,body{height:100%}
body{
  margin:0; background:var(--bg); color:var(--fg);
  font-family:var(--font-ui); overflow:hidden;
  -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
}
.sr-only{position:absolute !important; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0}

/* ---------- Background stack ---------- */
.bg-container{position:fixed; inset:0; z-index:-2}
.bg-image{
  position:absolute; inset:0;
  background-size:cover; background-position:center;
  opacity:0;
  filter:blur(1.5px) brightness(1.08) saturate(1.08);
  transition:opacity var(--fade-dur) cubic-bezier(.77,0,.18,1);
  will-change:opacity, filter;
}
.bg-image.active{opacity:1; z-index:1}

/* On pause: keep brightness/saturation the SAME, just remove blur */
:root[data-motion="paused"] .bg-image.active{filter:blur(0) brightness(1.08) saturate(1.08)}

/* ---------- Header + title ---------- */
header{
  min-height:calc(var(--vh) * 100);
  display:flex; flex-direction:column; justify-content:flex-end; align-items:center; text-align:center;
  z-index:10; pointer-events:none;
  padding-bottom:calc(env(safe-area-inset-bottom, 0px) + var(--ui-bottom-pad));
  text-shadow:0 0 1px rgba(0,0,0,.9), 0 0 8px rgba(0,0,0,.6);
}
@supports (height: 100svh){ header{ min-height:100svh } }
@supports (height: 100dvh){ header{ min-height:100dvh } }

.glitch-title{ display:flex; flex-wrap:wrap; justify-content:center; gap:.14em; margin-bottom:.25em; pointer-events:auto }
.glitch-letter{
  font-size:clamp(2.2rem, 6.0vw, 4.2rem);
  font-weight:800; text-transform:uppercase; letter-spacing:.03em;
  color:#d6d6d6; display:inline-block; position:relative;
  opacity:0; transform:translateY(18px) scale(.994);
  filter:contrast(1.12) brightness(1.03) saturate(1.2);
  transition:opacity 1.2s cubic-bezier(.77,0,.18,1), transform 1.2s cubic-bezier(.77,0,.18,1);
}
.glitch-letter.visible{opacity:1; transform:translateY(0) scale(1)}
.glitch-letter .glitch-main{position:relative; z-index:4; display:inline-block}
.glitch-letter .glitch-r, .glitch-letter .glitch-g, .glitch-letter .glitch-b, .glitch-letter .glitch-k{
  position:absolute; inset:0; z-index:3; pointer-events:none;
  opacity:0; filter:blur(.9px) brightness(1.12) contrast(1.25);
  mix-blend-mode:screen;
  transition:opacity 300ms ease-out, transform 140ms ease-out, filter 160ms ease-out;
}
.glitch-letter .glitch-r{color:var(--crt-magenta)}
.glitch-letter .glitch-g{color:var(--crt-cyan)}
.glitch-letter .glitch-b{color:var(--crt-blue)}
.glitch-letter .glitch-k{color:#000; mix-blend-mode:multiply; z-index:2}
.glitch-letter::before, .glitch-letter::after{
  content:attr(data-char); position:absolute; inset:0; z-index:1; pointer-events:none;
  opacity:.10; filter:blur(1.05px) brightness(1.18) contrast(1.35);
  mix-blend-mode:lighten; font-family:var(--font-ui);
}
.glitch-letter::before{color:#0ff; transform:translate(-1px,.4px)}
.glitch-letter::after{color:#f0f; transform:translate( 1px,-.4px)}
.glitch-letter .glitch-line{
  position:absolute; left:0; width:100%; height:2px; z-index:5; pointer-events:none;
  background:linear-gradient(90deg, #fff0, #fff4 40%, #fff0 100%);
  opacity:0; filter:blur(.35px) brightness(1.2);
  transition:opacity 260ms ease-out, transform 140ms ease-out, filter 160ms ease-out;
}

/* ---------- Nav ---------- */
nav{margin-top:.1em; margin-bottom:clamp(12px, 5vh, 40px)}
nav ul{list-style:none; padding:0; margin:0; display:flex; gap:clamp(1em, 4vw, 2.6em); font-size:1.05em; flex-wrap:wrap; justify-content:center}
nav li{opacity:0; transform:translateY(18px) scale(.994); transition:opacity .95s cubic-bezier(.77,0,.18,1), transform .95s cubic-bezier(.77,0,.18,1)}
nav li.visible{opacity:1; transform:translateY(0) scale(1)}
nav a{color:#fff; text-decoration:none; letter-spacing:.03em; text-shadow:0 0 1px rgba(0,0,0,.9), 0 0 8px rgba(0,0,0,.6); pointer-events:auto}

/* ---------- Footer (center on mobile, left on desktop) ---------- */
footer{
  position:fixed; left:0; right:0;
  bottom:env(safe-area-inset-bottom, 0px);
  padding:.5em .7em; z-index:11; pointer-events:none;
  display:block; text-align:center;
}
footer p{
  margin:0 auto;
  display:inline-block;
  background:
    linear-gradient(rgba(0,0,0,.72), rgba(0,0,0,.72)),
    repeating-linear-gradient(to bottom, rgba(255,255,255,.05) 0 1px, transparent 2px 4px);
  padding:.28em .6em; border-radius:6px; letter-spacing:.03em;
  border:1px solid rgba(255,255,255,.1);
  pointer-events:auto; font-size:.83em; /* ~2% smaller than last build */
  max-width:88vw; white-space:normal; line-height:1.25; text-align:center;
}
@media (pointer:fine) and (min-width:901px){
  footer{ display:flex; justify-content:flex-start; text-align:left }
  footer p{ margin:0 .7em }
}

/* ---------- Motion button (top-right) ---------- */
#ui-top{position:fixed; right:14px; top:calc(env(safe-area-inset-top, 0px) + 14px); z-index:120000; display:flex; align-items:center}
#motionBtn{
  background:
    linear-gradient(rgba(0,0,0,.90), rgba(0,0,0,.90)),
    repeating-linear-gradient(to bottom, rgba(255,255,255,.05) 0 1px, transparent 2px 4px);
  color:var(--fg); border:1px solid rgba(255,255,255,.22);
  border-radius:6px; padding:8px 10px; cursor:pointer; font-family:var(--font-ui)
}

/* ---------- CRT layers ---------- */
.scanlines{
  position:fixed; inset:0; z-index:100010; pointer-events:none; mix-blend-mode:multiply;
  background-image:repeating-linear-gradient(
    rgba(0,0,0,0.35) 0px, rgba(0,0,0,0.35) 1.5px,
    rgba(0,0,0,0.15) 2.5px, rgba(0,0,0,0.25) 3.5px,
    rgba(0,0,0,0.12) 4.5px, rgba(0,0,0,0.25) 6px
  );
  animation:scanlineGlitch 2.8s steps(2) infinite;
  mask-image:linear-gradient(to bottom, transparent 0%, #000 12%, #000 88%, transparent 100%);
  -webkit-mask-image:linear-gradient(to bottom, transparent 0%, #000 12%, #000 88%, transparent 100%);
}
@keyframes scanlineGlitch{ 0%,100%{transform:translateY(0)} 35%{transform:translateY(-1px)} 65%{transform:translateY(1px)} }
.scanlines-rgb{
  position:fixed; inset:0; z-index:100011; pointer-events:none; mix-blend-mode:screen; opacity:.06;
  background-image:
    repeating-linear-gradient(to bottom, rgba(255,0,76,.06) 0 2px, transparent 4px),
    repeating-linear-gradient(to bottom, rgba(0,255,200,.06) 0 2px, transparent 4px),
    repeating-linear-gradient(to bottom, rgba(0,170,255,.06) 0 2px, transparent 4px);
  animation:rgbDrift 10s ease-in-out infinite alternate;
}
@keyframes rgbDrift{ 0%{ transform:translateX(0) } 100%{ transform:translateX(1.1px) } }
.scanlines-rgb.glitch{ opacity:.11; transform:translateX(1.6px); transition:opacity .2s ease, transform .2s ease }
.scanline-sweep{
  position:fixed; left:0; right:0; top:-28vh; height:28vh;
  z-index:100012; pointer-events:none;
  filter:url(#crt-sweep-noise-strong);
  backdrop-filter:contrast(1.55) brightness(1.08) saturate(1.22) hue-rotate(2deg) blur(1px);
  -webkit-backdrop-filter:contrast(1.55) brightness(1.08) saturate(1.22) hue-rotate(2deg) blur(1px);
  -webkit-mask-image:linear-gradient(to bottom, transparent 0%, #fff 16%, #fff 84%, transparent 100%);
  mask-image:linear-gradient(to bottom, transparent 0%, #fff 16%, #fff 84%, transparent 100%);
  mix-blend-mode:screen; opacity:.24; will-change:transform, filter;
}
.scanline-sweep::before{content:""; position:absolute; inset:0; background-image:var(--bg-current); background-size:cover; background-position:center; mix-blend-mode:lighten; opacity:.12}
.scanline-sweep::after{content:""; position:absolute; inset:0; background:repeating-linear-gradient(to bottom, rgba(255,255,255,.16) 0px, rgba(255,255,255,.16) 1px, rgba(255,255,255,0) 2px); opacity:.12; mix-blend-mode:screen}
.scanline-sweep.run{animation-name:sweepDown, sweepJitter; animation-duration:var(--sweep-dur), 260ms; animation-timing-function:cubic-bezier(.22,.61,.36,1), steps(2,end); animation-iteration-count:1, infinite; animation-fill-mode:both, none}
@keyframes sweepDown{ 0%{ top:-28vh } 100%{ top:112vh } }
@keyframes sweepJitter{ 0%{ transform:translateX(0) } 50%{ transform:translateX(1.8px) } 100%{ transform:translateX(0) } }
.crt-vignette{
  position:fixed; inset:0; z-index:100009; pointer-events:none;
  background:
    radial-gradient(120% 120% at 50% 80%, rgba(0,0,0,.28), rgba(0,0,0,0) 48%),
    radial-gradient(120% 120% at 50% -20%, rgba(0,0,0,.28), rgba(0,0,0,0) 48%);
  mix-blend-mode:multiply;
}

/* ---------- Mini windows (ABOVE scanlines) ---------- */
.mini{
  position:fixed; z-index:200000; /* above overlays */
  width:min(92vw, 680px);
  max-height:min(75vh, 620px);
  overflow:auto; padding:16px 18px; color:var(--fg);
  background:rgba(0,0,0,.86); border:1px solid rgba(255,255,255,.12); border-radius:12px;
  box-shadow:0 6px 40px rgba(0,0,0,.55)
}
.mini .close{ position:absolute; top:8px; right:8px; background:transparent; border:0; color:var(--fg); font-size:1.2rem; cursor:pointer }
.mini h2, .mini h3{ margin:.25rem 0 .5rem 0; letter-spacing:.02em }
.mini .btn-link{ background:none; border:1px solid rgba(255,255,255,.16); border-radius:8px; padding:.4em .6em; color:var(--fg); text-decoration:none; cursor:pointer }
.mini .btn-link:hover{ background:rgba(255,255,255,.06) }

/* Music */
.music audio{ width:100%; margin:.25rem 0 .5rem 0 }
.playlist{ display:flex; flex-wrap:wrap; gap:.4rem }
.playlist .trk{ border:1px solid rgba(255,255,255,.16); background:transparent; color:var(--fg); border-radius:8px; padding:.3rem .5rem; cursor:pointer; }
.playlist .trk.active{ outline:2px solid var(--crt-cyan) }

/* PDF */
.pdf-actions{ display:flex; gap:.6rem; align-items:center; margin: .25rem 0 .5rem 0 }
.pdf-frame{ border:1px solid rgba(255,255,255,.1); border-radius:8px; overflow:hidden; }
.pdf-frame object{ width:100%; height:min(55vh, 420px); background:#111 }

/* Gallery */
.gallery-wrap h3{ margin-top:.5rem }
.gallery-stage{
  position:relative; width:100%;
  background:#000; border:1px solid rgba(255,255,255,.1); border-radius:8px;
  aspect-ratio: 16 / 9;  /* keeps height stable; no jumps */
  display:grid; place-items:center; overflow:hidden;
}
.gallery-stage picture, .gallery-stage img{ width:100%; height:100% }
.gallery-stage img{ object-fit:contain; transition:opacity .3s ease }
.gallery-stage .nav{
  position:absolute; top:50%; transform:translateY(-50%);
  background:rgba(0,0,0,.72); color:var(--fg); border:1px solid rgba(255,255,255,.16);
  border-radius:8px; width:36px; height:36px; cursor:pointer;
}
.gallery-stage .nav.prev{ left:8px } .gallery-stage .nav.next{ right:8px }

/* ---------- Accessibility ---------- */
a,button,[tabindex]{ outline:none }
a:focus-visible,button:focus-visible,[tabindex]:focus-visible{
  box-shadow:0 0 0 2px var(--crt-cyan), 0 0 12px 2px rgba(0,255,200,.35);
  border-radius:4px
}

/* ---------- Reduced motion ---------- */
@media (prefers-reduced-motion: reduce){
  .scanlines, .scanlines-rgb, .scanline-sweep, .crt-vignette, .glitch-line{ display:none !important }
  .glitch-r,.glitch-g,.glitch-b,.glitch-k{ display:none !important }
  .bg-image{ transition-duration:.3s; filter:none }
}