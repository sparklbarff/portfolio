/* Core styles for CRT-inspired website */

:root {
  --vh: 1vh;
  --font-ui: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
  --bg: #0a0a0a;
  --fg: #e8e8e8;
  --crt-cyan: #00ffc8;
  --crt-magenta: #ff004c;
  --crt-blue: #00aaff;
  --fade-dur: 15s;
  --period: 20s;
  --ui-bottom-pad: 72px;
  --sweep-dur: 7.2s;
}

/* CRT power-on effect */
@keyframes crtPowerUp {
  0% { 
    opacity: 0;
    filter: brightness(0) contrast(1);
  }
  5% { 
    opacity: 1;
    filter: brightness(2) contrast(3) blur(4px); 
  }
  10% { 
    filter: brightness(0.1) contrast(1.2) blur(0); 
  }
  15% { 
    filter: brightness(1.5) contrast(2) blur(2px); 
  }
  18%, 22% { 
    filter: brightness(0.8) contrast(1.2) blur(0); 
  }
  25%, 35% { 
    filter: brightness(1) contrast(1) blur(0); 
  }
  40%, 42% { 
    filter: brightness(1.2) contrast(1.3); 
  }
  60%, 100% { 
    filter: brightness(1) contrast(1); 
  }
}

.crt-powerup {
  position: fixed;
  inset: 0;
  z-index: 200000;
  background: white;
  mix-blend-mode: overlay;
  pointer-events: none;
  animation: crtPowerUp 1.2s cubic-bezier(0.23, 1, 0.32, 1) forwards;
}

/* Add "CRT Off" class for initial state */
.crt-off .scanlines,
.crt-off .scanlines-rgb,
.crt-off .crt-vignette {
  opacity: 0;
}

/* Add CRT turn-on effect for scanlines */
@keyframes scanlinesFadeIn {
  0% { opacity: 0; }
  80% { opacity: 0; }
  100% { opacity: 1; }
}

body.crt-off {
  animation: crtActivate 0.6s ease-out forwards 0.3s;
}

@keyframes crtActivate {
  to { 
    filter: brightness(1) contrast(1);
  }
}

/* Reset and base styles */
* {
  -webkit-tap-highlight-color: transparent;
  box-sizing: border-box;
}

html, body {
  height: 100%;
}

body {
  margin: 0;
  background: var(--bg);
  color: var(--fg);
  font-family: var(--font-ui);
  overflow: hidden;
  -webkit-font-smoothing: antialiased;
  text-rendering: optimizeLegibility;
}

/* Accessibility */
.sr-only {
  position: absolute !important;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

/* Background system */
.bg-container {
  position: fixed;
  inset: 0;
  z-index: -2;
}

.bg-image {
  position: absolute;
  inset: 0;
  background-size: cover;
  background-position: center;
  opacity: 0;
  filter: blur(1.5px) brightness(1.08) saturate(1.08);
  transition: opacity var(--fade-dur) cubic-bezier(.77, 0, .18, 1);
  will-change: opacity, filter;
}

.bg-image.active {
  opacity: 1;
  z-index: 1;
}

:root[data-motion="paused"] .bg-image.active {
  filter: blur(0) brightness(1) saturate(1);
}

/* Header and hero section */
header {
  min-height: calc(var(--vh) * 100);
  display: flex;
  flex-direction: column;
  justify-content: flex-end;
  align-items: center;
  text-align: center;
  z-index: 10;
  pointer-events: none;
  padding-bottom: calc(env(safe-area-inset-bottom, 0px) + var(--ui-bottom-pad));
  text-shadow: 0 0 1px rgba(0, 0, 0, .9), 0 0 8px rgba(0, 0, 0, .6);
  gap: clamp(1rem, 3vh, 2rem);
}

@supports (height: 100svh) {
  header {
    min-height: 100svh;
  }
}

@supports (height: 100dvh) {
  header {
    min-height: 100dvh;
  }
}

/* Title glitch letters */
#glitch-title {
  line-height: 1;
  margin-bottom: 0.1em;
  display: block;
  min-height: 1.05em;
}

#glitch-title .tg-letter {
  font-size: clamp(3.2rem, 8.5vw, 5.6rem);
  font-weight: 800;
  text-transform: uppercase;
  letter-spacing: .02em;
  line-height: 1.05;
}

/* Nav elements */
nav {
  margin-top: .2em;
  margin-bottom: clamp(12px, 5vh, 40px);
}

#nav-list {
  list-style: none;
  padding: 0;
  margin: 0;
  display: flex;
  gap: clamp(1.6rem, 5vw, 3rem);
  flex-wrap: wrap;
  justify-content: center;
}

#nav-list a {
  color: #fff;
  text-decoration: none;
  font-size: clamp(1.3rem, 3.5vw, 1.8rem);
  letter-spacing: .02em;
  padding: 0.2em 0.5em;
  position: relative;
  text-shadow: 0 0 1px rgba(0, 0, 0, .9), 0 0 8px rgba(0, 0, 0, .6);
  pointer-events: auto;
  transition: color 0.2s;
}

/* Footer */
footer {
  position: fixed;
  left: 0;
  right: 0;
  bottom: env(safe-area-inset-bottom, 0px);
  padding: .5em .7em;
  z-index: 11;
  pointer-events: none;
  display: block;
  text-align: left;
}

footer p {
  margin: 0 .7em;
  display: inline-block;
  background: 
    linear-gradient(rgba(0, 0, 0, .72), rgba(0, 0, 0, .72)),
    repeating-linear-gradient(to bottom, rgba(255, 255, 255, .05) 0 1px, transparent 2px 4px);
  padding: .28em .6em;
  border-radius: 6px;
  letter-spacing: .03em;
  border: 1px solid rgba(255, 255, 255, .1);
  pointer-events: auto;
  font-size: .83em;
  max-width: 88vw;
  white-space: normal;
  line-height: 1.25;
  text-align: left;
}

/* Motion toggle button */
#ui-top {
  position: fixed;
  right: 14px;
  top: calc(env(safe-area-inset-top, 0px) + 14px);
  z-index: 12;
  display: flex;
  align-items: center;
}

#motionBtn {
  background:
    linear-gradient(rgba(0, 0, 0, .90), rgba(0, 0, 0, .90)),
    repeating-linear-gradient(to bottom, rgba(255, 255, 255, .05) 0 1px, transparent 2px 4px);
  color: var(--fg);
  border: 1px solid rgba(255, 255, 255, .22);
  border-radius: 6px;
  padding: 8px 10px;
  cursor: pointer;
  font-family: var(--font-ui);
}

/* CRT effects */
.scanlines {
  position: fixed;
  inset: 0;
  z-index: 100010;
  pointer-events: none;
  mix-blend-mode: multiply;
  background-image: repeating-linear-gradient(
    rgba(0, 0, 0, 0.35) 0px,
    rgba(0, 0, 0, 0.35) 1.5px,
    rgba(0, 0, 0, 0.15) 2.5px,
    rgba(0, 0, 0, 0.25) 3.5px,
    rgba(0, 0, 0, 0.12) 4.5px,
    rgba(0, 0, 0, 0.25) 6px
  );
  animation: scanlineGlitch 2.8s steps(2) infinite;
  mask-image: linear-gradient(to bottom, transparent 0%, #000 12%, #000 88%, transparent 100%);
  -webkit-mask-image: linear-gradient(to bottom, transparent 0%, #000 12%, #000 88%, transparent 100%);
}

@keyframes scanlineGlitch {
  0%, 100% { transform: translateY(0); }
  35% { transform: translateY(-1px); }
  65% { transform: translateY(1px); }
}

.scanlines-rgb {
  position: fixed;
  inset: 0;
  z-index: 100011;
  pointer-events: none;
  mix-blend-mode: screen;
  opacity: .06;
  background-image:
    repeating-linear-gradient(to bottom, rgba(255, 0, 76, .06) 0 2px, transparent 4px),
    repeating-linear-gradient(to bottom, rgba(0, 255, 200, .06) 0 2px, transparent 4px),
    repeating-linear-gradient(to bottom, rgba(0, 170, 255, .06) 0 2px, transparent 4px);
  animation: rgbDrift 10s ease-in-out infinite alternate;
}

@keyframes rgbDrift {
  0% { transform: translateX(0); }
  100% { transform: translateX(1.1px); }
}

.scanlines-rgb.glitch {
  opacity: .11;
  transform: translateX(1.6px);
  transition: opacity .2s ease, transform .2s ease;
}

.scanline-sweep {
  position: fixed;
  left: 0;
  right: 0;
  top: -28vh;
  height: 28vh;
  z-index: 100012;
  pointer-events: none;
  filter: url(#crt-sweep-filter);
  backdrop-filter: contrast(1.55) brightness(1.08) saturate(1.22) hue-rotate(2deg) blur(1px);
  -webkit-backdrop-filter: contrast(1.55) brightness(1.08) saturate(1.22) hue-rotate(2deg) blur(1px);
  -webkit-mask-image: linear-gradient(to bottom, transparent 0%, #fff 16%, #fff 84%, transparent 100%);
  mask-image: linear-gradient(to bottom, transparent 0%, #fff 16%, #fff 84%, transparent 100%);
  mix-blend-mode: screen;
  opacity: .35;
  will-change: transform, filter;
}

:root.no-bdf .scanline-sweep {
  backdrop-filter: none;
  -webkit-backdrop-filter: none;
  filter: url(#crt-sweep-filter);
  opacity: .18;
}

.crt-vignette {
  position: fixed;
  inset: 0;
  z-index: 100009;
  pointer-events: none;
  background:
    radial-gradient(120% 120% at 50% 80%, rgba(0, 0, 0, .28), rgba(0, 0, 0, 0) 48%),
    radial-gradient(120% 120% at 50% -20%, rgba(0, 0, 0, .28), rgba(0, 0, 0, 0) 48%);
  mix-blend-mode: multiply;
}

/* Mini popup container */
.mini {
  position: fixed;
  z-index: 200001;
  width: min(92vw, 680px);
  max-height: min(80vh, 640px);
  overflow: auto;
  padding: 16px 18px;
  color: var(--fg);
  background: rgba(0, 0, 0, .86);
  border: 1px solid rgba(255, 255, 255, .12);
  border-radius: 6px;
  box-shadow: 0 6px 40px rgba(0, 0, 0, .55);
}

.mini .close {
  position: absolute;
  top: 8px;
  right: 8px;
  background: transparent;
  border: 0;
  color: var(--fg);
  font-size: 1.2rem;
  cursor: pointer;
}

/* Animations */
@keyframes sweepDown {
  0% { transform: translateY(-100vh); }
  100% { transform: translateY(200vh); }
}

.scanline-sweep.run {
  animation: sweepDown var(--sweep-dur) cubic-bezier(.22, .61, .36, 1) forwards;
}

/* Focus states */
a, button, [tabindex] {
  outline: none;
}

a:focus-visible, button:focus-visible, [tabindex]:focus-visible {
  box-shadow: 0 0 0 2px #00ffc8, 0 0 12px 2px rgba(0, 255, 200, .35);
  border-radius: 4px;
}

/* Responsive adjustments */
@media (pointer: coarse), (max-width: 900px) {
  footer {
    text-align: center;
  }
  
  footer p {
    margin: 0 auto;
  }
  
  #nav-list a {
    font-size: clamp(1.25rem, 4vw, 1.6rem);
    padding: 0.3em 0.6em; /* Larger touch target */
  }
}

@media (prefers-reduced-motion: reduce) {
  .scanlines, .scanlines-rgb, .scanline-sweep, .crt-vignette {
    display: none !important;
  }
  
  .bg-image {
    transition-duration: .3s;
    filter: none;
  }
}