<!-- portfolio mini â€¢ self-contained and scoped -->
<style>
  .port{
    --font-ui: var(--font-ui, "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Consolas, monospace);
    --fg: var(--fg, #e6e6e6);
    --bg: var(--bg, #0a0a0a);
    --cyan: #00ffc8;
    --panel-border: rgba(255,255,255,.25);
    --panel-shadow: rgba(0,0,0,.55);
    font-family: var(--font-ui);
    color: var(--fg);
  }
  .port h2{ margin:.25rem 0 .4rem; font-size:1rem; }

  .port .tracks{
    display:flex; justify-content:center; align-items:center;
    gap:.5rem; padding:.35rem 0 .5rem; flex-wrap:wrap;
  }
  .port .trk{
    flex:0 0 auto; cursor:pointer;
    font:700 .95rem/1 var(--font-ui); letter-spacing:.02em;
    color:var(--fg); background:rgba(0,0,0,.6);
    border:1px dashed var(--cyan); border-radius:9px;
    padding:.5rem .7rem; user-select:none;
    transition:transform .08s ease;
  }
  .port .trk:active{ transform:scale(.98) }
  .port .trk.active{ background:var(--cyan); color:#000; }
  .port .trk:focus-visible{ outline:2px solid var(--cyan); outline-offset:2px; }

  .port .player{
    background:#000; border:1px solid var(--panel-border);
    border-radius:14px; padding:.6rem .75rem; margin-bottom:1rem;
    box-shadow:0 6px 40px var(--panel-shadow);
    position: relative;
  }
  .port .controls{
    display:flex; align-items:center; gap:.75rem;
  }
  .port .btn{
    width:48px; height:48px; border:0; background:transparent;
    display:inline-flex; align-items:center; justify-content:center;
    cursor:pointer; border-radius:10px;
  }
  .port .btn:focus-visible{ outline:2px solid var(--cyan); outline-offset:2px; }
  .port .btn svg{ width:28px; height:28px; fill:#fff; display:block; }

  .port .loading-bar {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 3px;
    background: linear-gradient(90deg, transparent, var(--cyan), transparent);
    background-size: 200% 100%;
    animation: loading-sweep 1.2s infinite linear;
    opacity: 0;
    transition: opacity 0.2s;
    border-radius: 14px 14px 0 0;
  }
  @keyframes loading-sweep {
    0% { background-position: 200% 0; }
    100% { background-position: -200% 0; }
  }
  .port .player.is-loading .loading-bar {
    opacity: 1;
  }

  .port .seek{ flex:1; display:flex; align-items:center; gap:.6rem; }
  .port .time{ font:600 .8rem/1 var(--font-ui); opacity:.9; min-width:4.2ch; text-align:right; }
  .port input[type="range"]{ -webkit-appearance:none; appearance:none; width:100%; height:6px; background:#222; border-radius:3px; }
  .port input[type="range"]::-webkit-slider-thumb{ -webkit-appearance:none; width:14px; height:14px; border-radius:50%; background:#fff; }
  .port input[type="range"]::-moz-range-thumb{ width:14px; height:14px; border-radius:50%; background:#fff; border:0; }
  .port input[type="range"]:focus-visible { outline: 2px solid var(--cyan); outline-offset: 4px; }

  .port .stage{
    position:relative; width:87%; margin:.6rem auto 1rem;
    aspect-ratio:16/9;
    background:#000; border:1px solid var(--panel-border);
    border-radius:12px; overflow:hidden; box-shadow:0 6px 40px var(--panel-shadow);
    touch-action:pan-y;
  }
  @media (max-width: 740px){
    .port .stage{ aspect-ratio:4/5; }
  }
  .port .stage img{ 
    width:100%; height:100%; object-fit:contain; display:block; background:#000;
    transition: opacity 0.3s ease;
  }
  .port .stage img.loading { 
    opacity: 0.4;
  }
  .port .stage.error::after {
    content: "Image failed to load";
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: rgba(255,255,255,0.7);
    font-size: 0.9rem;
  }

  /* Fix navigation button styling */
  .port .nav{
    position:absolute; top:50%; transform:translateY(-50%);
    width:46px; height:46px; border-radius:12px;
    background:rgba(0,0,0,.55); color:#fff;
    border:1px solid var(--panel-border); cursor:pointer; user-select:none;
    display:flex; align-items:center; justify-content:center;
    z-index:2;
    pointer-events:auto;
    font-size: 24px; /* Make nav arrows larger */
    font-family: Arial, sans-serif; /* Use a reliable font for arrows */
  }
  .port .nav.prev{ left:10px } .port .nav.next{ right:10px }
  .port .nav:focus-visible{ outline:2px solid var(--cyan); outline-offset:2px; }

  .port .resume{ text-align:center; margin:.2rem 0 .2rem; }
  .port .resume a{
    display:inline-block; text-decoration:none; color:var(--fg);
    background:rgba(0,0,0,.6); border:1px dashed var(--cyan);
    border-radius:10px; padding:.5rem .9rem; letter-spacing:.02em;
  }
  .port .resume a:focus-visible{ outline:2px solid var(--cyan); outline-offset:2px; }

  .port .sr-status {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border-width: 0;
  }
</style>

<div class="port" id="port-root">
  <div class="tracks" id="tracks"></div>

  <div class="player" id="playerBox" role="group" aria-label="Music player">
    <div class="loading-bar"></div>
    <audio id="audio" preload="none" hidden></audio>
    <div class="controls">
      <button class="btn" id="playBtn" aria-label="Play" title="Play">
        <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
      </button>

      <div class="seek">
        <span class="time" id="cur">0:00</span>
        <input id="seek" type="range" min="0" max="100" value="0" step="0.1" aria-label="Seek">
        <span class="time" id="dur">0:00</span>
      </div>

      <button class="btn" id="muteBtn" aria-label="Mute" title="Mute">
        <svg viewBox="0 0 24 24"><path d="M4 9v6h4l5 4V5L8 9H4z"/></svg>
      </button>
    </div>
    <div id="playerStatus" class="sr-status" aria-live="polite"></div>
  </div>

  <div class="stage" id="stage">
    <button class="nav prev" id="prev" aria-label="Previous image">&lt;</button>
    <img id="shot" alt="Portfolio artwork" class="loading">
    <button class="nav next" id="next" aria-label="Next image">&gt;</button>
    <div id="galleryStatus" class="sr-status" aria-live="polite"></div>
  </div>

  <div class="resume">
    <a href="../../assets/resume/resume.pdf" download>resume.pdf</a>
  </div>
</div>

<script>
(() => {
  const AUDIO_BASE = 'assets/audio/'; // Changed from '../../assets/audio/'
  const tracks = [
    {file:'frark1999.mp3', label:'frark'},
    {file:'fulcrum.mp3',   label:'fulcrum'},
    {file:'sttd.mp3', label:'sttd'},
    {file:'trance.mp3',    label:'trance'},
    {file:'whatwhat.mp3',  label:'whatwhat'},
  ];
  const tracksBar = document.getElementById('tracks');
  const audio = document.getElementById('audio');
  const playerBox = document.getElementById('playerBox');
  const playBtn = document.getElementById('playBtn');
  const muteBtn = document.getElementById('muteBtn');
  const seek = document.getElementById('seek');
  const curT = document.getElementById('cur');
  const durT = document.getElementById('dur');
  const playerStatus = document.getElementById('playerStatus');

  let activeBtn = null;
  let currentTrack = null;
  
  function pretty(t){
    if (!isFinite(t)) return '0:00';
    const m = Math.floor(t/60), s = Math.floor(t%60);
    return m + ':' + (s<10?'0':'') + s;
  }
  function setIcon(btn, type){
    const icons = {
      play:   '<path d="M8 5v14l11-7z"/>',
      pause:  '<path d="M6 5h4v14H6zm8 0h4v14h-4z"/>',
      speaker:'<path d="M4 9v6h4l5 4V5L8 9H4z"/>',
      mute:   '<path d="M4 9v6h4l5 4V5L8 9H4z M16 9l5 5m0-5l-5 5" stroke="#fff" stroke-width="2" fill="none"/>'
    };
    btn.querySelector('svg').innerHTML = icons[type];
    
    if (type === 'play') {
      btn.setAttribute('aria-label', 'Play');
      btn.setAttribute('title', 'Play');
    } else if (type === 'pause') {
      btn.setAttribute('aria-label', 'Pause');
      btn.setAttribute('title', 'Pause');
    } else if (type === 'speaker') {
      btn.setAttribute('aria-label', 'Mute');
      btn.setAttribute('title', 'Mute');
    } else if (type === 'mute') {
      btn.setAttribute('aria-label', 'Unmute');
      btn.setAttribute('title', 'Unmute');
    }
  }

  function announcePlayer(message) {
    playerStatus.textContent = message;
  }

  tracks.forEach(t => {
    const b = document.createElement('button');
    b.className = 'trk';
    b.textContent = t.label;
    b.dataset.src = AUDIO_BASE + t.file;
    b.addEventListener('click', () => {
      if (activeBtn === b && !audio.paused) {
        // If clicking the active button and audio is playing, pause it
        audio.pause();
        return;
      }
      
      // If a different track was playing or this is a new track
      if (activeBtn) activeBtn.classList.remove('active');
      activeBtn = b;
      activeBtn.classList.add('active');
      
      if (currentTrack !== b.dataset.src) {
        // Load new track only if it's different
        currentTrack = b.dataset.src;
        audio.src = currentTrack;
        
        playerBox.classList.add('is-loading');
        announcePlayer(`Loading track ${t.label}`);
      }
      
      audio.play().then(() => {
        playerBox.classList.remove('is-loading');
        announcePlayer(`Playing ${t.label}`);
      }).catch(err => {
        playerBox.classList.remove('is-loading');
        announcePlayer(`Failed to play ${t.label}`);
      });
    });
    tracksBar.appendChild(b);
  });

  playBtn.addEventListener('click', () => {
    if (!currentTrack) {
      // If no track is selected, pick a random one
      const randomIndex = Math.floor(Math.random() * tracks.length);
      const randomTrackBtn = tracksBar.children[randomIndex];
      randomTrackBtn.click(); // This will select and play the random track
      return;
    }
    
    if (audio.paused) {
      playerBox.classList.add('is-loading');
      audio.play().then(() => {
        playerBox.classList.remove('is-loading');
        if (activeBtn) {
          announcePlayer(`Playing ${activeBtn.textContent}`);
        } else {
          announcePlayer("Playing audio");
        }
      }).catch(err => {
        playerBox.classList.remove('is-loading');
        announcePlayer("Failed to play audio");
      });
    } else {
      audio.pause();
      announcePlayer("Paused");
    }
  });
  
  // Ensure current active button syncs with audio state
  audio.addEventListener('play', () => {
    setIcon(playBtn, 'pause');
    if (activeBtn) activeBtn.classList.add('active');
  });
  
  audio.addEventListener('pause', () => {
    setIcon(playBtn, 'play');
  });
  
  audio.addEventListener('waiting', () => {
    playerBox.classList.add('is-loading');
  });
  
  audio.addEventListener('canplay', () => {
    playerBox.classList.remove('is-loading');
  });

  muteBtn.addEventListener('click', () => {
    audio.muted = !audio.muted;
    setIcon(muteBtn, audio.muted ? 'mute' : 'speaker');
    announcePlayer(audio.muted ? "Muted" : "Unmuted");
  });

  audio.addEventListener('loadedmetadata', () => {
    durT.textContent = pretty(audio.duration);
  });
  
  audio.addEventListener('timeupdate', () => {
    if (!audio.duration) return;
    curT.textContent = pretty(audio.currentTime);
    seek.value = (audio.currentTime / audio.duration) * 100;
  });
  
  seek.addEventListener('input', () => {
    if (!audio.duration) return;
    audio.currentTime = (seek.value / 100) * audio.duration;
    curT.textContent = pretty(audio.currentTime);
  });

  audio.addEventListener('ended', () => {
    if (activeBtn) {
      const nextTrack = activeBtn.nextElementSibling || tracksBar.firstElementChild;
      if (nextTrack && nextTrack.classList.contains('trk')) {
        nextTrack.click();
      }
    }
    announcePlayer("Track ended");
  });

  audio.addEventListener('error', () => {
    playerBox.classList.remove('is-loading');
    announcePlayer("Audio error occurred");
  });

  const shot = document.getElementById('shot');
  const stage = document.getElementById('stage');
  const prev = document.getElementById('prev');
  const next = document.getElementById('next');
  const galleryStatus = document.getElementById('galleryStatus');

  const BASE = 'mybg/png/'; // Changed from '../../mybg/png/'
  const IMAGE_COUNT = 45;

  let images = [];
  let imageIndexes = [];
  let cache = new Map();

  (async () => {
    const MAX = Math.min(IMAGE_COUNT, 20);
    const want = 12;
    
    for (let i = 1; i <= MAX && images.length < want; i++) {
      const url = `${BASE}bg${i}.png`;
      images.push(url);
      imageIndexes.push(i);
    }
    
    if (images.length === 0) {
      stage.classList.add('error');
      return;
    }
    
    let current = 0;
    
    function loadImage(url, index) {
      if (cache.has(url)) {
        return Promise.resolve(cache.get(url));
      }
      
      return new Promise((resolve, reject) => {
        const img = new Image();
        img.onload = () => {
          cache.set(url, img);
          resolve(img);
        };
        
        img.onerror = () => {
          reject(new Error(`Failed to load image: ${url}`));
        };
        img.src = url;
      });
    }
    
    async function showImage(index) {
      if (index < 0) index = images.length - 1;
      if (index >= images.length) index = 0;
      current = index;
      
      const url = images[current];
      const imgIndex = imageIndexes[current];
      
      try {
        shot.classList.add('loading');
        shot.alt = "Portfolio artwork"; // Simplified alt text
        
        await loadImage(url, imgIndex);
        shot.src = url;
        shot.classList.remove('loading');
        stage.classList.remove('error');
        
        galleryStatus.textContent = `Image ${current + 1} of ${images.length}`;
      } catch (err) {
        shot.classList.remove('loading');
        stage.classList.add('error');
        galleryStatus.textContent = "Image failed to load";
      }
    }
    
    showImage(0);
    
    prev.addEventListener('click', () => showImage(current - 1));
    next.addEventListener('click', () => showImage(current + 1));
    
    document.addEventListener('keydown', e => {
      if (!document.querySelector('.mini')) return;
      if (e.key === 'ArrowLeft') showImage(current - 1);
      if (e.key === 'ArrowRight') showImage(current + 1);
    });
    
    let touchStartX = 0;
    let touchEndX = 0;
    
    function handleSwipe() {
      const threshold = 50;
      if (touchStartX - touchEndX > threshold) {
        showImage(current + 1);
      } else if (touchEndX - touchStartX > threshold) {
        showImage(current - 1);
      }
    }
    
    stage.addEventListener('touchstart', e => {
      touchStartX = e.changedTouches[0].screenX;
    }, { passive: true });
    
    stage.addEventListener('touchend', e => {
      touchEndX = e.changedTouches[0].screenX;
      handleSwipe();
    }, { passive: true });
  })();
})();
</script>