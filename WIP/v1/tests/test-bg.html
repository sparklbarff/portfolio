<!DOCTYPE html>
<html>
  <head>
    <title>Background Test</title>
    <style>
      :root {
        --period: 7s;
      }
      .bg-container {
        position: fixed;
        inset: 0;
        z-index: -1;
      }
      .bg-image {
        position: absolute;
        inset: 0;
        background-position: center;
        background-size: cover;
        background-repeat: no-repeat;
        opacity: 0;
        transition: opacity 2s ease-in-out;
      }
      .bg-image.active {
        opacity: 1;
      }
      #debug {
        position: fixed;
        top: 10px;
        left: 10px;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 10px;
        font-family: monospace;
        z-index: 1000;
      }
    </style>
  </head>
  <body>
    <div id="debug">Loading...</div>
    <div class="bg-container" id="bg-container"></div>

    <script>
      console.log("Starting background test...");

      const debug = document.getElementById("debug");
      const bgContainer = document.getElementById("bg-container");

      let currentIndex = 0;
      let images = [];

      // Test manifest loading
      fetch("manifest.json")
        .then((response) => {
          debug.innerHTML += "<br>Manifest fetch: " + response.status;
          return response.json();
        })
        .then((manifest) => {
          debug.innerHTML +=
            "<br>Manifest loaded: " + manifest.count + " images";

          // Generate image paths
          for (let i = 1; i <= manifest.count; i++) {
            images.push(`${manifest.path}/bg${i}.${manifest.extension}`);
          }

          debug.innerHTML += "<br>Images array: " + images.length;

          // Test first image load
          const firstSrc = images[0];
          debug.innerHTML += "<br>Loading: " + firstSrc;

          const first = document.createElement("div");
          first.className = "bg-image active";
          first.style.backgroundImage = `url(${firstSrc})`;
          bgContainer.appendChild(first);

          debug.innerHTML += "<br>First image added";

          // Test period calculation
          const period =
            parseFloat(
              getComputedStyle(document.documentElement).getPropertyValue(
                "--period"
              )
            ) * 1000 || 7000;

          debug.innerHTML += "<br>Period: " + period + "ms";

          // Start cycling
          let cycleCount = 0;
          const timer = setInterval(() => {
            cycleCount++;
            debug.innerHTML +=
              "<br>Cycle " +
              cycleCount +
              ": switching to image " +
              (((currentIndex + 1) % images.length) + 1);

            const nextIndex = (currentIndex + 1) % images.length;
            const nextSrc = images[nextIndex];

            const next = document.createElement("div");
            next.className = "bg-image";
            next.style.backgroundImage = `url(${nextSrc})`;
            bgContainer.appendChild(next);

            setTimeout(() => {
              // Remove old active
              const current = document.querySelector(".bg-image.active");
              if (current) current.classList.remove("active");

              // Activate new
              next.classList.add("active");
              currentIndex = nextIndex;

              // Clean up old images
              const oldImages = document.querySelectorAll(
                ".bg-image:not(.active)"
              );
              oldImages.forEach((img) => img.remove());
            }, 50);
          }, period);

          debug.innerHTML += "<br>Timer started";
        })
        .catch((error) => {
          debug.innerHTML += "<br>ERROR: " + error.message;
          console.error("Test error:", error);
        });
    </script>
  </body>
</html>
